<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Login | The BIU Archive</title>
    <link rel="stylesheet" href="theme.css">
    <script>(function(){try{var t=localStorage.getItem('site-theme')||'dark';document.documentElement.classList.add('theme-'+t);}catch(e){}})();</script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
    <meta name="google-signin-client_id" content="137837754242-gte1234567890.apps.googleusercontent.com">
    <style>
        :root {
            --primary: #002147; --accent: #FFD700; --bg: #f8f9fa;
            --white: #ffffff; --text: #333; --input-bg: #fff; --radius: 20px;
        }

        [data-theme="dark"] {
            --primary: #FFD700; --accent: #002147; --bg: #121212;
            --white: #1e1e1e; --text: #f4f4f4; --input-bg: #2a2a2a;
        }

        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background-color: var(--bg); color: var(--text); 
            margin: 0; display: flex; justify-content: center; 
            align-items: center; min-height: 100vh; padding: 20px;
            transition: 0.3s; box-sizing: border-box; overflow: hidden;
        }

        .container { 
            background: var(--white); padding: 3rem 2rem; 
            border-radius: var(--radius); box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
            width: 100%; max-width: 420px; text-align: center; position: relative;
        }

        .theme-toggle {
            position: absolute; top: 20px; right: 20px;
            background: rgba(128,128,128,0.1); border: none;
            width: 40px; height: 40px; border-radius: 50%;
            font-size: 18px; cursor: pointer; display: flex;
            align-items: center; justify-content: center; transition: 0.3s;
        }

        input {
            width: 100%; padding: 16px; margin: 12px 0; 
            border: 2px solid rgba(0,0,0,0.05); border-radius: 12px; 
            box-sizing: border-box; background: var(--input-bg);
            color: var(--text); font-size: 15px; outline: none;
            transition: 0.3s; font-weight: 500;
        }

        input:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0, 33, 71, 0.05); }

        .btn-vault {
            width: 100%; padding: 18px; background: var(--primary); 
            color: var(--white); border: none; border-radius: 12px; 
            cursor: pointer; font-weight: 800; font-size: 15px;
            margin-top: 20px; transition: 0.3s; text-transform: uppercase;
            letter-spacing: 1.5px; box-shadow: 0 8px 20px rgba(0, 33, 71, 0.15);
        }

        .btn-vault:active { transform: scale(0.98); }

        /* --- AUTH UI --- */
        #auth-overlay {
            position: fixed; inset: 0; background: rgba(0, 33, 71, 0.95);
            backdrop-filter: blur(10px); z-index: 999; display: none;
            flex-direction: column; align-items: center; justify-content: center; color: white;
        }

        .loader {
            width: 50px; height: 50px; border: 5px solid #FFF;
            border-bottom-color: var(--accent); border-radius: 50%;
            animation: rotation 1s linear infinite; margin-bottom: 20px;
        }

        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .blink-text { font-weight: 900; letter-spacing: 3px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        #success-toast {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            background: #22c55e; color: white; padding: 18px 35px;
            border-radius: 15px; box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            z-index: 1000; display: flex; align-items: center; gap: 15px;
            transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #success-toast.show { top: 30px; }

        .footer-links { margin-top: 15px; font-size: 13px; font-weight: 600; }
        .footer-links a { color: var(--primary); text-decoration: none; margin: 0 5px; }

        footer { margin-top: 40px; font-size: 11px; opacity: 0.6; border-top: 1px solid rgba(128,128,128,0.1); padding-top: 25px; }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="loader"></div>
        <div class="blink-text">VERIFYING CREDENTIALS...</div>
    </div>

    <div id="success-toast">
        <span style="font-size: 28px;">üîë</span>
        <div style="text-align: left;">
            <div style="font-weight: 900; font-size: 16px;">ACCESS GRANTED</div>
            <div style="font-size: 11px; opacity: 0.9;">Opening the Archive...</div>
        </div>
    </div>

    <div class="container">
        <button class="theme-toggle" id="theme-btn">üåì</button>
        <h1 style="color:var(--primary); margin: 0; font-weight: 900; font-size: 2rem;">The BIU Archive</h1>
        <p style="font-size: 13px; margin-bottom: 30px; font-weight: 600; opacity: 0.7;">Benson Idahosa University Legacy</p>

        <form id="login-form">
            <input type="email" id="email" placeholder="Student Email" required>
            <input type="password" id="password" placeholder="Password" required>
            
            <div style="display:flex; align-items:center; justify-content: space-between; margin-top:5px; padding: 0 5px;">
                <div style="display:flex; align-items:center; gap:8px;">
                    <input type="checkbox" id="remember" style="width:16px; margin:0;">
                    <label for="remember" style="font-size:12px; font-weight:600; opacity:0.8;">Stay Signed In</label>
                </div>
                <a href="#" style="font-size:12px; color:var(--primary); text-decoration: none; font-weight:600;">Forgot?</a>
            </div>

            <button type="submit" class="btn-vault" id="submit-btn">UNLOCK ARCHIVE</button>
            
            <div style="margin: 20px 0; position: relative; text-align: center;">
                <span style="background: var(--white); padding: 0 10px; position: relative; z-index: 1; color: #999; font-size: 12px; font-weight: 600;">OR</span>
                <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: rgba(0,0,0,0.05); z-index: 0;"></div>
            </div>

            <button type="button" onclick="loginWithGoogle()" style="width: 100%; padding: 18px; background: #ffffff; color: var(--primary); border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; cursor: pointer; font-weight: 800; font-size: 15px; margin-top: 0; display: flex; align-items: center; justify-content: center; gap: 10px; text-transform: uppercase; letter-spacing: 1.5px;">
                <span style="font-size: 18px;">üîê</span> Login with Google
            </button>
            
            <div class="footer-links">
                <span>New?</span><a href="signup.html">Create Identity</a>
            </div>
        </form>

        <footer style="color: var(--text);">
            <strong>Designed by Celebrity Attitude</strong><br>
            CSC ‚Ä¢ 100 Level ‚Ä¢ &copy; 2026 The BIU Archive
        </footer>
    </div>

    <script>
        // FIREBASE CONFIG
        const firebaseConfig = {
          apiKey: "AIzaSyC0QC_qi2aKIIT5axmN5rk-3igybyxoqW0",
          authDomain: "biuarchive.firebaseapp.com",
          databaseURL: "https://biuarchive-default-rtdb.firebaseio.com",
          projectId: "biuarchive",
          storageBucket: "biuarchive.firebasestorage.app",
          messagingSenderId: "137837754242",
          appId: "1:137837754242:web:4da8aa153cd505e6de019b",
          measurementId: "G-9KYG7N5F1T"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        const overlay = document.getElementById('auth-overlay');
        const toast = document.getElementById('success-toast');
        const loginForm = document.getElementById('login-form');

        // Google Login Handler
        async function loginWithGoogle() {
            overlay.style.display = 'flex';
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('profile');
                provider.addScope('email');
                const result = await auth.signInWithPopup(provider);
                const user = result.user;

                // Ensure user exists in DB
                const userRef = db.ref('users/' + user.uid);
                const snapshot = await userRef.once('value');
                if (!snapshot.exists()) {
                    await userRef.set({
                        full_name: user.displayName || user.email.split('@')[0],
                        email: user.email,
                        department: "Not Set",
                        matric_no: "GOOGLE_AUTH",
                        isVerified: false,
                        preferredTheme: 'dark',
                        streak: 0,
                        profilePic: user.photoURL || '',
                        createdAt: firebase.database.ServerValue.TIMESTAMP
                    });
                }

                overlay.style.display = 'none';
                toast.classList.add('show');
                setTimeout(() => { window.location.href = 'index.html'; }, 1800);
            } catch (err) {
                overlay.style.display = 'none';
                alert("Google Login Error: " + err.message);
            }
        }

        // --- THEME ENGINE (unified) ---
        const themeBtn = document.getElementById('theme-btn');
        function toggleTheme(){
            try{
                const current = localStorage.getItem('site-theme') || 'dark';
                const next = current === 'light' ? 'dark' : 'light';
                localStorage.setItem('site-theme', next);
                document.documentElement.classList.remove('theme-dark','theme-light');
                document.documentElement.classList.add('theme-'+next);
            }catch(e){}
        }
        themeBtn.addEventListener('click', toggleTheme);

        // Ensure theme.js is available and applied
        (function(){
            var s=document.createElement('script'); s.src='theme.js'; s.defer=true; document.body.appendChild(s);
        })();

        // --- SESSION PERSISTENCE ---
        window.onload = () => {
            const savedEmail = localStorage.getItem('biu_email');
            if(savedEmail) {
                document.getElementById('email').value = savedEmail;
                document.getElementById('remember').checked = true;
            }
        };

        // --- CORE LOGIN LOGIC ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            overlay.style.display = 'flex';

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const remember = document.getElementById('remember').checked;

            try {
                // Firebase authentication
                const result = await auth.signInWithEmailAndPassword(email, password);
                
                // Handle "Remember Me"
                if(remember) {
                    localStorage.setItem('biu_email', email);
                } else {
                    localStorage.removeItem('biu_email');
                }

                // UI feedback
                overlay.style.display = 'none';
                toast.classList.add('show');

                // Instant transition to index
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 1800);

            } catch (error) {
                overlay.style.display = 'none';
                alert("Vault Error: " + error.message);
            }
        });
    </script>
</body>
</html>