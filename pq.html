<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Past Questions | BIU Archive</title>
    <link rel="stylesheet" href="theme.css">
    <script>(function(){try{var t=localStorage.getItem('site-theme')||'dark';document.documentElement.classList.add('theme-'+t);}catch(e){}})();</script>
    <style>
        :root {
            --primary: #002147; 
            --accent: #FFD700; 
            --light: #f8f9fa;
            --white: #ffffff; 
            --text: #333; 
            --success: #28a745; 
            --info: #17a2b8;
            --radius: 16px;
        }
        [data-theme="dark"] {
            --primary: #FFD700; 
            --accent: #002147; 
            --light: #121212;
            --white: #1e1e1e; 
            --text: #f4f4f4;
        }
        body { 
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; 
            background-color: var(--light); 
            color: var(--text); 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            padding: 15px; 
            transition: 0.3s; 
            min-height: 100vh;
        }
        .container { 
            background: var(--white); 
            padding: 2rem; 
            border-radius: var(--radius); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            width: 100%; 
            max-width: 850px; 
            text-align: center; 
            position: relative; 
            box-sizing: border-box;
        }
        .hidden { display: none !important; }
        
        /* NAVIGATION */
        .top-nav { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            display: flex; 
            gap: 10px; 
            z-index: 10; 
        }
        .nav-btn { 
            padding: 10px 15px; 
            border-radius: 12px; 
            border: none; 
            cursor: pointer; 
            font-size: 12px; 
            font-weight: 800; 
            background: var(--primary); 
            color: var(--white); 
            transition: 0.2s; 
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .nav-btn:active { transform: scale(0.95); }
        
        /* SEARCH BAR */
        .search-container { margin: 30px 0 15px 0; width: 100%; }
        #courseSearch { 
            width: 100%; 
            padding: 15px 20px; 
            border-radius: 12px; 
            border: 1.5px solid rgba(0,0,0,0.1); 
            background: var(--light); 
            color: var(--text); 
            font-size: 16px; 
            box-sizing: border-box; 
            outline: none; 
            transition: 0.3s;
        }
        #courseSearch:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0, 33, 71, 0.1); }

        /* TABS */
        .tab-container { 
            display: flex; 
            justify-content: center; 
            gap: 8px; 
            margin: 10px 0 25px 0; 
            overflow-x: auto; 
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
        }
        .tab-btn { 
            background: rgba(0,0,0,0.05); 
            padding: 10px 20px; 
            border-radius: 25px; 
            border: none; 
            cursor: pointer; 
            font-size: 13px; 
            color: var(--text); 
            white-space: nowrap;
            font-weight: 600;
            transition: 0.2s;
        }
        .tab-btn.active { background: var(--primary); color: var(--white); }

        /* GRID & CARDS */
        .course-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); 
            gap: 15px; 
            margin-top: 20px; 
        }
        .course-card { 
            border: 1px solid rgba(0,0,0,0.05); 
            padding: 20px; 
            border-radius: 14px; 
            text-align: left; 
            background: var(--light); 
            transition: 0.3s; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .course-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .course-card h3 { margin: 0; font-size: 1.1rem; font-weight: 800; color: var(--primary); }
        .course-card p { margin: 5px 0; font-size: 0.9rem; opacity: 0.7; font-weight: 600; }
        
        .download-btn { 
            width: 100%; 
            padding: 12px; 
            background: var(--primary); 
            color: var(--white); 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 800; 
            margin-top: 15px; 
            font-size: 13px;
        }

        /* TOAST */
        #toast { visibility: hidden; min-width: 250px; background: var(--primary); color: #fff; text-align: center; border-radius: 12px; padding: 16px; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.2); border-bottom: 4px solid var(--accent); font-weight: bold; }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
        
        footer { margin-top: 50px; font-size: 11px; opacity: 0.5; letter-spacing: 1px; font-weight: bold; text-transform: uppercase; }

        @media (max-width: 480px) {
            .container { padding: 1.5rem; border-radius: 0; }
            .top-nav { position: relative; top: 0; right: 0; margin-bottom: 20px; justify-content: center; }
            h1 { font-size: 1.5rem !important; margin-top: 10px !important; }
            .course-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div id="toast"></div>

    <div class="container">
        <div class="top-nav">
            <button class="nav-btn" onclick="window.location.href='index.html'">üè† Home</button>
            <button class="nav-btn" onclick="toggleTheme()">üåì Theme</button>
        </div>

        <h1 style="margin-top: 50px; font-weight: 900;">PQ Bank</h1>
        <p style="font-weight: 600; opacity: 0.8;">Scholar: <span id="display-name" style="color:var(--info);">...</span></p>

        <div class="search-container">
            <input type="text" id="courseSearch" placeholder="Search course code..." onkeyup="filterCourses()">
        </div>

        <div class="tab-container">
            <button class="tab-btn active" id="btn-all" onclick="filterTab('all', this)">All PQs</button>
            <button class="tab-btn" onclick="filterTab('cat-gst', this)">GSTs</button>
            <button class="tab-btn" onclick="filterTab('cat-sci', this)">Sciences/Math</button>
            <button class="tab-btn" onclick="filterTab('cat-dept', this)">Departmental</button>
        </div>

        <div class="course-grid" id="course-list">
            <div class="course-card cat-gst">
                <div>
                    <h3>GST 111</h3><p>Communication English</p>
                </div>
                <button class="download-btn" onclick="handleDownload('GST 111','https://docs.google.com/document/d/1cICV9V2Wtywaofp_1cA84ItLXu-vve-p/edit')">View PQ</button>
            </div>
            <div class="course-card cat-gst">
                <div>
                    <h3>GST 112</h3><p>People and Culture</p>
                </div>
                <button class="download-btn" onclick="handleDownload('GST 112','https://drive.google.com/file/d/1o290W5ofDBxyoik0WC-y-VdjyHUqylJN/view')">View PQ</button>
            </div>
            <div class="course-card cat-gst">
                <div>
                    <h3>IDS 111</h3><p>Rudiments of Faith</p>
                </div>
                <button class="download-btn" onclick="handleDownload('IDS 111','https://docs.google.com/document/d/1dYTcgJQBICb8L5ZNvX4z_nb6H2d7Pd_M/edit')">View PQ</button>
            </div>
            <div class="course-card cat-sci">
                <div>
                    <h3>MTH 111</h3><p>General Mathematics</p>
                </div>
                <button class="download-btn" onclick="handleDownload('MTH 111','https://docs.google.com/document/d/1IHjwn7HRnlUoypBEOJL2-k_u0ptZ8GEq/edit')">View PQ</button>
            </div>
            <div class="course-card cat-sci">
                <div>
                    <h3>MTH 112</h3><p>Elementary Statistics</p>
                </div>
                <button class="download-btn" onclick="handleDownload('MTH 112','https://docs.google.com/document/d/1jFZFlzQvHxNbnzY35d19kOoOGLX6NxyF/edit?usp=drivesdk&ouid=111271384522252483913&rtpof=true&sd=true')">View PQ</button>
            </div>
            <div class="course-card cat-sci">
                <div>
                    <h3>CSC 113</h3><p>Intro Programming II</p>
                </div>
                <button class="download-btn" onclick="handleDownload('CSC 113','https://docs.google.com/document/d/1QJxLjtQTpA1AHVFRgEfwe24QPZPHGti-/edit?usp=drivesdk&ouid=111271384522252483913&rtpof=true&sd=true')">View PQ</button>
            </div>
            <div class="course-card cat-sci">
                <div>
                    <h3>CHM 111</h3><p>General Chemistry I</p>
                </div>
                <button class="download-btn" onclick="handleDownload('CHM 111','https://drive.google.com/file/d/1w8e61Q8bRlr3mnwR_ELex5n-tTeOsi8k/view')">View PQ</button>
            </div>
            <div class="course-card cat-dept">
                <div>
                    <h3>CSC 111</h3><p>Intro to Computer Science</p>
                </div>
                <button class="download-btn" onclick="handleDownload('CSC 111','https://docs.google.com/document/d/1tGh6b6NQTMQoF_IpiMb6HY-xQ5HrsPyf/view')">View PQ</button>
            </div>
            <div class="course-card cat-sci">
                <div>
                    <h3>CHM 113</h3><p>Organic & Inorganic Basics</p>
                </div>
                <button class="download-btn" onclick="handleDownload('CHM 113','https://drive.google.com/file/d/1YQTm7bRCGPls4Q0SaGnGA57cPOCXhPB3/view?usp=drivesdk')">View PQ</button>
            </div>
            <div class="course-card cat-sci">
                <div>
                    <h3>ZOO 111</h3><p>Introductory Zoology</p>
                </div>
                <button class="download-btn" onclick="handleDownload('ZOO 111','https://drive.google.com/file/d/1d5X3OVPWjmrQhd1ybgulCBHZEqgvvbSp/view?usp=drivesdk')">View PQ</button>
            </div>
        </div>

        <div id="dynamic-pqs" style="margin-top:22px;"></div>

        <footer>
            The BIU Archive &copy; 2026
        </footer>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC0QC_qi2aKIIT5axmN5rk-3igybyxoqW0",
            authDomain: "biuarchive.firebaseapp.com",
            databaseURL: "https://biuarchive-default-rtdb.firebaseio.com",
            projectId: "biuarchive",
            storageBucket: "biuarchive.firebasestorage.app",
            messagingSenderId: "137837754242",
            appId: "1:137837754242:web:4da8aa153cd505e6de019b",
            measurementId: "G-9KYG7N5F1T"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let currentCategory = 'all';

        // Theme helpers (use 'site-theme')
        function applyTheme(name) {
            try {
                document.documentElement.classList.remove('theme-dark','theme-light');
                document.documentElement.classList.add('theme-' + name);
                document.body.setAttribute('data-theme', name);
                localStorage.setItem('site-theme', name);
            } catch (e) {}
        }

        window.toggleTheme = function() {
            const current = localStorage.getItem('site-theme') || 'dark';
            const next = current === 'dark' ? 'light' : 'dark';
            applyTheme(next);
        };

        // Show snack and open link
        window.handleDownload = function(t, u) {
            const toast = document.getElementById('toast');
            toast.innerText = `‚úÖ Opening ${t} Past Question...`;
            toast.className = "show";
            setTimeout(() => { toast.className = ""; window.open(u, '_blank'); }, 1200);
        };

        // Course filtering
        window.filterCourses = function() {
            const query = document.getElementById('courseSearch').value.toLowerCase();
            document.querySelectorAll('.course-card').forEach(card => {
                const title = card.querySelector('h3').innerText.toLowerCase();
                const desc = card.querySelector('p').innerText.toLowerCase();
                const matchesCategory = (currentCategory === 'all' || card.classList.contains(currentCategory));
                const matchesSearch = title.includes(query) || desc.includes(query);

                card.style.display = (matchesCategory && matchesSearch) ? 'flex' : 'none';
            });
        };

        window.filterTab = function(category, btn) {
            currentCategory = category;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            filterCourses();
        };

        function applyAccess() { document.querySelectorAll('.course-card').forEach(el => el.classList.remove('hidden')); }
        applyAccess();

        // Load dynamic past questions from Realtime DB
        function renderPastQuestions(snapshot) {
            const container = document.getElementById('dynamic-pqs');
            container.innerHTML = '';
            if (!snapshot) return;
            snapshot.forEach(itemSnap => {
                const item = itemSnap.val();
                const card = document.createElement('div');
                card.className = 'course-card';
                card.style.marginTop = '10px';
                card.innerHTML = `
                    <div>
                        <h3>${item.course || item.title || 'Past Question'}</h3>
                        <p style="font-weight:700; opacity:0.8;">${item.title || item.course || ''}</p>
                    </div>
                    <button class="download-btn">Open</button>
                `;
                const btn = card.querySelector('.download-btn');
                btn.addEventListener('click', () => window.open(item.url, '_blank'));
                container.appendChild(card);
            });
        }

        // Auth enforcement + user data sync
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                // If no firebase user, fall back to localStorage check; if none, redirect
                const nameLocal = localStorage.getItem('biu_user_name');
                if (!nameLocal) return window.location.href = 'login.html';
                document.getElementById('display-name').innerText = nameLocal;
                // Still try to load dynamic PQs (read-only)
                onValue(ref(db, 'past_questions'), (snap) => renderPastQuestions(snap));
                return;
            }

            const uid = user.uid;
            // Sync display name and theme from DB
            onValue(ref(db, `users/${uid}`), (snap) => {
                const data = snap.val() || {};
                document.getElementById('display-name').innerText = data.full_name || user.email || 'Scholar';
                if (data.preferredTheme) applyTheme(data.preferredTheme);
            });

            // Load dynamic PQs
            onValue(ref(db, 'past_questions'), (snap) => renderPastQuestions(snap));
        });

    </script>
    <script src="theme.js" defer></script>
</body>
</html>