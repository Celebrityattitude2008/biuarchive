<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Notes | BIU Archive</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">

    <nav class="bg-blue-900 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-tight">BIU<span class="text-blue-400">Archive</span></h1>
            <a href="index.html" class="text-sm bg-blue-800 px-3 py-1 rounded hover:bg-blue-700 transition">Back to Home</a>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <div id="payment-box" class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8 rounded-r-lg shadow-md">
            <div class="flex flex-col md:flex-row justify-between gap-6">
                <div>
                    <h3 class="text-lg font-bold text-blue-900 mb-2">Unlock Premium Access</h3>
                    <p class="text-blue-800 mb-4">Transfer <b>â‚¦5,000</b> to the account below:</p>
                    <div class="bg-white p-4 rounded-lg border border-blue-200 inline-block">
                        <p class="text-xs text-gray-500 font-bold">Bank: <span class="text-gray-800">OPay</span></p>
                        <p class="text-xs text-gray-500 font-bold mt-1">Acc No: <span class="text-blue-700 text-lg">7041795388</span></p>
                        <p class="text-xs text-gray-500 font-bold mt-1">Name: <span class="text-gray-800">Paul Adamu</span></p>
                    </div>
                </div>
                <div class="flex flex-col justify-center">
                    <button onclick="startVerification()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-10 rounded-xl transition-all shadow-lg">
                        I Have Made the Transfer
                    </button>
                </div>
            </div>
        </div>

        <div id="status-overlay" class="hidden fixed inset-0 bg-blue-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-white p-8 rounded-2xl max-w-sm w-full text-center shadow-2xl">
                <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-600 mx-auto mb-6"></div>
                <h3 class="text-2xl font-bold text-gray-800">Verifying...</h3>
                <p class="text-gray-600 mt-4 text-sm">Please do not close this page. Paul is verifying your receipt on WhatsApp.</p>
                <button onclick="document.getElementById('status-overlay').classList.add('hidden')" class="mt-6 text-xs text-gray-400 underline">Cancel</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100">
                <h3 class="text-xl font-bold border-b pb-2 mb-4 text-blue-900">CSC 111 Notes</h3>
                <ul class="space-y-3" id="csc-list">
                    <li class="flex justify-between items-center">
                        <span>Week 1 Note</span>
                        <a href="#" class="note-link text-gray-400 cursor-not-allowed font-bold" data-url="https://docs.google.com/document/d/1h4bQbzrBq0Wy-Einz69xmdYMWz55ydY3/edit">Locked ðŸ”’</a>
                    </li>
                    <li class="flex justify-between items-center">
                        <span>Week 2 Note</span>
                        <a href="#" class="note-link text-gray-400 cursor-not-allowed font-bold" data-url="https://docs.google.com/document/d/1jh4GRfoYRw6MTaDj_I2XkUeDhwWPSSES/edit">Locked ðŸ”’</a>
                    </li>
                    <li class="flex justify-between items-center">
                        <span>Week 4 Note</span>
                        <a href="#" class="note-link text-gray-400 cursor-not-allowed font-bold" data-url="https://docs.google.com/document/d/1JJI3XIsuKNWgxtcj_m8gHFY-zx1l9bKx/edit">Locked ðŸ”’</a>
                    </li>
                    <li class="flex justify-between items-center">
                        <span>Week 5 Note</span>
                        <a href="#" class="note-link text-gray-400 cursor-not-allowed font-bold" data-url="https://docs.google.com/document/d/1Noh_u4kM0M0XQ7OKHSFRSjt5X3FnTwmM/edit">Locked ðŸ”’</a>
                    </li>
                </ul>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100">
                <h3 class="text-xl font-bold border-b pb-2 mb-4 text-blue-900">Physics Notes (111/113)</h3>
                <ul class="space-y-3">
                    <li class="flex justify-between items-center">
                        <span>Full Physics Note/PQs Folder</span>
                        <a href="#" class="note-link text-gray-400 cursor-not-allowed font-bold" data-url="https://drive.google.com/drive/folders/16H9xh6u8rctHtdYjv-OPetsA6Djo11Vj?usp=sharing">Locked ðŸ”’</a>
                    </li>
                </ul>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-md border border-gray-100 opacity-60">
                <h3 class="text-xl font-bold border-b pb-2 mb-4 text-gray-500">Other Courses</h3>
                <p class="text-sm italic">Unlock premium to see all 100L departmental notes.</p>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBmZDLDyQ2YhMxsYal1q4d0hyr03VXEqak",
            authDomain: "biu-archive.firebaseapp.com",
            databaseURL: "https://biu-archive-default-rtdb.firebaseio.com",
            projectId: "biu-archive",
            storageBucket: "biu-archive.firebasestorage.app",
            messagingSenderId: "245967347998",
            appId: "1:245967347998:web:a8feb5ad0ef9650946a90f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const studentName = localStorage.getItem('biu_user_name');
        let userId = localStorage.getItem('biu_user_id');

        if (!studentName) {
            alert("Please login first!");
            window.location.href = 'index.html';
        }

        // Generate ID if missing
        if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('biu_user_id', userId);
        }

        // Check if user is already paid
        onValue(ref(db, "paid_users/" + userId), (snapshot) => {
            if (snapshot.val() === true) { 
                unlockNotes(); 
            }
        });

        window.startVerification = function() {
            document.getElementById('status-overlay').classList.remove('hidden');
            const whatsappUrl = `https://wa.me/2347041795388?text=${encodeURIComponent("Hello Paul, I just paid for the BIU Notes Archive.\n\nName: " + studentName + "\nUser ID: " + userId)}`;
            setTimeout(() => { window.open(whatsappUrl, '_blank'); }, 1500);
        }

        function unlockNotes() {
            document.getElementById('status-overlay').classList.add('hidden');
            const pBox = document.getElementById('payment-box');
            if(pBox) pBox.style.display = 'none';
            
            document.querySelectorAll('.note-link').forEach(link => {
                const realUrl = link.getAttribute('data-url');
                link.setAttribute('href', realUrl);
                link.setAttribute('target', '_blank');
                link.classList.replace('text-gray-400', 'text-green-600');
                link.classList.remove('cursor-not-allowed');
                link.innerHTML = 'View Note ðŸ”“';
            });
        }
    </script>
</body>
</html>